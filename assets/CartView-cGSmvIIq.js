import{f as _,g as z,o as l,c as a,a as e,t as c,F as q,h as T,i as m,j as D,v as P,b as v,w as G,r as I,n as H,d as M,k as w}from"./index-hthFqwET.js";import{M as J}from"./bootstrap.esm-TTjMTX3M.js";import{a as g}from"./axios-L6U4YIEh.js";import{S as U}from"./main-toIP9Pq-.js";const K={class:"modal-dialog modal-xl",role:"document"},Q={class:"modal-content border-0"},W={class:"modal-header bg-dark text-white"},X={class:"modal-title",id:"exampleModalLabel"},Y=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Z={class:"modal-body"},ee={class:"row"},te={class:"col-sm-6"},se=["src"],oe={class:"col-sm-6"},le={class:"badge bg-primary rounded-pill"},ae={key:0,class:"h5"},ne={key:1,class:"h6"},de={key:2,class:"h5"},ie={class:"input-group"},ce={__name:"userProductModal",props:["product"],emits:["emitModalInModalComponent","add-to-cart"],setup(R,{emit:f}){const r=R,V=f,d=_(null),C=_(null),x=_(1);return z(()=>{d.value=new J(C.value,{backdrop:"static"}),V("emitModalInModalComponent",d)}),(p,i)=>(l(),a("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"productModalRef",ref:C},[e("div",K,[e("div",Q,[e("div",W,[e("h5",X,[e("span",null,c(r.product.title),1)]),Y]),e("div",Z,[e("div",ee,[e("div",te,[(l(!0),a(q,null,T(r.product.imagesUrl,b=>(l(),a("img",{class:"img-fluid",src:b,alt:"",key:b.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,se))),128))]),e("div",oe,[e("span",le,c(r.product.category),1),e("p",null,"商品描述："+c(r.product.description),1),e("p",null,"商品內容："+c(r.product.content),1),r.product.price?m("",!0):(l(),a("div",ae,c(r.product.origin_price)+" 元",1)),r.product.price?(l(),a("del",ne,"原價 "+c(r.product.origin_price)+" 元",1)):m("",!0),r.product.price?(l(),a("div",de,"現在只要 "+c(r.product.price)+" 元",1)):m("",!0),e("div",null,[e("div",ie,[D(e("input",{type:"number",class:"form-control","onUpdate:modelValue":i[0]||(i[0]=b=>x.value=b),min:"1"},null,512),[[P,x.value,void 0,{number:!0}]]),e("button",{type:"button",class:"btn btn-primary",onClick:i[1]||(i[1]=b=>p.$emit("add-to-cart",r.product.id,x.value))},"加入購物車(內)")])])])])])])])],512))}},re={class:"container"},ue={class:"mt-4"},pe={class:"table align-middle"},me=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1),_e={style:{width:"200px"}},he={key:0,class:"h5"},ve={key:1,class:"h6"},be={key:2,class:"h5"},fe={class:"btn-group btn-group-sm"},ge=["onClick","disabled"],ye={key:0,class:"fas fa-spinner fa-pulse"},ke=["onClick","disabled"],xe={key:0,class:"fas fa-spinner fa-pulse"},$e={key:0,class:"text-end"},Ce=e("h2",null,"先放一項商品試試吧",-1),Me=[Ce],Ve={key:1,class:"text-end"},we={class:"table align-middle"},Be=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),Ie=["onClick","disabled"],Ue={key:0,class:"fas fa-spinner fa-pulse"},qe={key:0,class:"text-success"},Te={class:"input-group input-group-sm"},De={class:"input-group mb-3"},Pe=["onUpdate:modelValue","onBlur","disabled"],Re={class:"input-group-text",id:"basic-addon2"},Se={class:"text-end"},ze={key:0,class:"text-success"},Ee=e("td",{colspan:"3",class:"text-end"},"總計",-1),Ne={class:"text-end"},Fe={key:0},Le=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),je={class:"text-end text-success"},Ae={class:"my-5 row justify-content-center"},Oe={class:"mb-3"},Ge=e("label",{for:"email",class:"form-label"},"Email",-1),He={class:"mb-3"},Je=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ke={class:"mb-3"},Qe=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),We={class:"mb-3"},Xe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Ye={class:"mb-3"},Ze=e("label",{for:"message",class:"form-label"},"留言",-1),et=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),y="https://ec-course-api.hexschool.io/v2",k="aca101139",at={__name:"CartView",setup(R){const f=U.mixin({toast:!0,position:"center",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:1500,timerProgressBar:!0}),r=_(null),V=_(null),d=_({loadingItem:""}),C=_([]),x=_({}),p=_({user:{name:"",email:"",tel:"",address:""},message:""}),i=_({}),b=_(null),E=()=>{const o=`${y}/api/${k}/products`;g.get(o).then(s=>{C.value=s.data.products}).catch(s=>{alert(s.response.data.message)})},N=o=>{const s=`${y}/api/${k}/product/${o}`;d.value.loadingItem=o,console.log(V.value.qty),g.get(s).then(n=>{d.value.loadingItem="",x.value=n.data.product,b.value.show()}).catch(n=>{alert(n.response.data.message)})},S=(o,s=1)=>{const n=`${y}/api/${k}/cart`;d.value.loadingItem=o;const h={product_id:o,qty:s};b.value.hide(),g.post(n,{data:h}).then(()=>{d.value.loadingItem="",$(),f.fire({icon:"success",title:"已加入購物車"})}).catch(B=>{alert(B.response.data.message)})},F=o=>{d.value.loadingItem=o.id;const s=`${y}/api/${k}/cart/${o.id}`,n={product_id:o.product_id,qty:o.qty};g.put(s,{data:n}).then(()=>{f.fire({icon:"success",title:"已更新購物車"}),d.value.loadingItem="",$()}).catch(h=>{alert(h.response.data.message),d.value.loadingItem=""})},L=()=>{U.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(s=>{s.isConfirmed?(f.fire({icon:"warning",title:"刪除成功"}),g.delete(o).then(()=>{$()}).catch(n=>{alert(n.response.data.message)})):s.isDenied&&f.fire({icon:"info",title:"已為您保留購物車內容"})}).catch(()=>{alert("伺服器錯誤")});const o=`${y}/api/${k}/carts`},$=()=>{const o=`${y}/api/${k}/cart`;g.get(o).then(s=>{i.value=s.data.data}).catch(s=>{alert(s.response.data.message)})},j=o=>{U.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(n=>{n.isConfirmed?(d.value.loadingItem=o,f.fire({icon:"warning",title:"刪除成功"}),g.delete(s).then(()=>{d.value.loadingItem="",$()}).catch(h=>{alert(h.response.data.message)})):n.isDenied&&f.fire({icon:"info",title:"已為您保留該品項"})});const s=`${y}/api/${k}/cart/${o}`},A=()=>{if(i.value.carts.length===0)alert("購物車內沒有品項");else{const o=`${y}/api/${k}/order`,s=p.value;g.post(o,{data:s}).then(n=>{alert(n.data.message),r.value.resetForm(),$()}).catch(n=>{alert(n.response.data.message)})}},O=(o,s)=>{b.value=o.value};return z(()=>{E(),$()}),(o,s)=>{const n=I("v-field"),h=I("error-message"),B=I("v-form");return l(),a("div",re,[e("div",ue,[v(ce,{ref_key:"userProductModalRef",ref:V,product:x.value,onAddToCart:S,onEmitModalInModalComponent:O},null,8,["product"]),e("table",pe,[me,e("tbody",null,[(l(!0),a(q,null,T(C.value,t=>(l(),a("tr",{key:t.id},[e("td",_e,[e("div",{style:H([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),e("td",null,c(t.title),1),e("td",null,[t.price?m("",!0):(l(),a("div",he,c(t.origin_price)+" 元 ",1)),t.price?(l(),a("del",ve,"原價 "+c(t.origin_price)+" 元",1)):m("",!0),t.price?(l(),a("div",be," 現在只要 "+c(t.price)+" 元 ",1)):m("",!0)]),e("td",null,[e("div",fe,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:u=>N(t.id),disabled:d.value.loadingItem===t.id||!t.is_enabled},[d.value.loadingItem===t.id?(l(),a("i",ye)):m("",!0),M(" 查看更多 ")],8,ge),e("button",{type:"button",class:"btn btn-outline-danger",onClick:u=>S(t.id),disabled:d.value.loadingItem===t.id||!t.is_enabled},[d.value.loadingItem===t.id?(l(),a("i",xe)):m("",!0),M(" 加到購物車 ")],8,ke)])])]))),128))])]),i.value.carts&&i.value.carts.length===0?(l(),a("div",$e,Me)):(l(),a("div",Ve,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:L}," 清空購物車 ")])),e("table",we,[Be,e("tbody",null,[i.value.carts?(l(!0),a(q,{key:0},T(i.value.carts,t=>(l(),a("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>j(t.id),disabled:d.value.loadingItem===t.id},[d.value.loadingItem===t.id?(l(),a("i",Ue)):m("",!0),M(" x ")],8,Ie)]),e("td",null,[M(c(t.product.title)+" ",1),t.coupon?(l(),a("div",qe," 已套用優惠券 ")):m("",!0)]),e("td",null,[e("div",Te,[e("div",De,[D(e("input",{"onUpdate:modelValue":u=>t.qty=u,onBlur:u=>F(t),disabled:d.value.loadingItem===t.id,min:"1",type:"number",class:"form-control"},null,40,Pe),[[P,t.qty,void 0,{number:!0}]]),e("span",Re,c(t.product.unit),1)])])]),e("td",Se,[i.value.final_total!==i.value.total?(l(),a("small",ze,"折扣價：")):m("",!0),M(" "+c(t.final_total),1)])]))),128)):m("",!0)]),e("tfoot",null,[e("tr",null,[Ee,e("td",Ne,c(i.value.total),1)]),i.value.final_total!==i.value.total?(l(),a("tr",Fe,[Le,e("td",je,c(i.value.final_total),1)])):m("",!0)])])]),e("div",Ae,[v(B,{ref_key:"formRef",ref:r,class:"col-md-6",onSubmit:A},{default:G(({errors:t})=>[e("div",Oe,[Ge,v(n,{id:"email",name:"email",type:"email",class:w(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:p.value.user.email,"onUpdate:modelValue":s[0]||(s[0]=u=>p.value.user.email=u)},null,8,["class","modelValue"]),v(h,{name:"email",class:"invalid-feedback"})]),e("div",He,[Je,v(n,{id:"name",name:"姓名",type:"text",class:w(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:p.value.user.name,"onUpdate:modelValue":s[1]||(s[1]=u=>p.value.user.name=u)},null,8,["class","modelValue"]),v(h,{name:"姓名",class:"invalid-feedback"})]),e("div",Ke,[Qe,v(n,{id:"tel",name:"電話",type:"text",class:w(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:p.value.user.tel,"onUpdate:modelValue":s[2]||(s[2]=u=>p.value.user.tel=u)},null,8,["class","modelValue"]),v(h,{name:"電話",class:"invalid-feedback"})]),e("div",We,[Xe,v(n,{id:"address",name:"地址",type:"text",class:w(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:p.value.user.address,"onUpdate:modelValue":s[3]||(s[3]=u=>p.value.user.address=u)},null,8,["class","modelValue"]),v(h,{name:"地址",class:"invalid-feedback"})]),e("div",Ye,[Ze,D(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=u=>p.value.message=u)},null,512),[[P,p.value.message]])]),et]),_:1},512)])])}}};export{at as default};
